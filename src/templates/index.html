<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Packing Algorithm Demo</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
</head>
<!-- Loading Spinner Overlay -->
<div id="loading-overlay">
  <div class="loading-content">
    <div class="spinner"></div>
    <p class="loading-text">Calculating...</p>
  </div>
</div>

<body>

  <div class="container">
    <!-- Title -->
    <header>
      <h1>Packing Algorithm Demo</h1>
      <p>Based on the article: <em>Your Algorithm Name Here</em></p>
    </header>

    <!-- Expandables -->
    <section class="expandables">
      <details>
        <summary>üß† About the Algorithm</summary>
        <p>Explain your algorithm here. You can include citation, behavior, etc.</p>
      </details>

      <details>
        <summary>üìò How to Use</summary>
        <p>Instructions on how users can input data, what to expect as output, etc.</p>
      </details>

      <details>
        <summary>üë©‚Äçüíª About the Developer</summary>
        <p>Write about yourself, your background, links to your GitHub, etc.</p>
      </details>
    </section>

    <!-- Input Section -->
    <section class="form-section">
      <form method="POST">
        <label>Items (comma-separated):</label>
        <input type="text" name="items" id="items" placeholder="e.g., 300, 150, 200, 400" />

        <label>Bin Size:</label>
        <input type="number" name="binsize" id="binsize" placeholder="e.g., 1000" />

        <label>method:</label>
        <select name="method" id="method">
          <option value="backtracking">backtracking</option>
          <option value="local search">local search</option>
        </select>

        <label for="log_level">Log Level:</label>
          <select id="log_level" name="log_level">
            <option value="DEBUG" {% if selected_log_level == "DEBUG" %}selected{% endif %}>DEBUG</option>
            <option value="INFO" {% if selected_log_level == "INFO" %}selected{% endif %}>INFO</option>
            <option value="WARNING" {% if selected_log_level == "WARNING" %}selected{% endif %}>WARNING</option>
            <option value="ERROR" {% if selected_log_level == "ERROR" %}selected{% endif %}>ERROR</option>
            <option value="CRITICAL" {% if selected_log_level == "CRITICAL" %}selected{% endif %}>CRITICAL</option>
          </select>

        <!-- <label for="binners">Select Binner:</label>
        <select name="binners" id="binners">
          {% for binner in binners %}
            <option value="{{ binner }}">{{ binner }}</option>
          {% endfor %}
        </select> -->

        {% if error_message %}
          <div class="error">{{ error_message }}</div>
        {% endif %}

        <div class="button-row">
          <button type="submit">Run Algorithm</button>
          <button type="button" onclick="fillExample()">Use Example Input</button>
        </div>
      </form>
    </section>

    <!-- Output Section -->
    {% if output %}
    <!-- <section class="output-section">
      <h2>üì¶ Output:</h2>
      <pre>{{ output }}</pre>

      <h3>ü™µ Run Logs:</h3>
      <pre>{{ logs }}</pre>
    </section> -->
    <section class="output-section" id="results">
    <h2>üì¶ Output:</h2>
    <pre>{{ output }}</pre>

    <h3>ü™µ Run Logs:</h3>
    <pre>{{ logs }}</pre>
    </section>
    {% endif %}
  </div>

  <!-- JavaScript -->
  <script>
    // Show spinner on form submit
    document.querySelector("form").addEventListener("submit", function () {
        document.getElementById("loading-overlay").style.display = "flex";
    });

    // Scroll to results after reload
    window.onload = function () {
        const results = document.getElementById("results");
        if (results) {
        results.scrollIntoView({ behavior: "smooth" });
        }
    };

  function fillExample() {
    // Constants similar to Python defaults
    const DEFAULT_BIN_SIZE = 1000;
    const DEFAULT_ITEM_NUM = 60;
    const MIN_BIN_SIZE = 50;
    const ITEM_NUM = 18;

    // Randomly choose bin_size and items_num (multiple of 3)
    let bin_size = Math.floor(Math.random() * 900) + 100; // 100‚Äì1000
    bin_size = Math.max(bin_size, MIN_BIN_SIZE);

    // let items_num = Math.floor(Math.random() * 30) * 3 + 3; // multiples of 3, between 3 and 90
    // items_num = Math.max(items_num, MIN_ITEM_NUM);

    const lower_bnd = Math.round(bin_size / 4);
    const upper_bnd = Math.round(bin_size / 2);

    const items = [];

    for (let i = 0; i < ITEM_NUM / 3; i++) {
      const item1 = getRandomInt(lower_bnd, upper_bnd);
      const item2 = getRandomInt(lower_bnd, upper_bnd);
      const item3 = bin_size - (item1 + item2);
      items.push(item1, item2, item3);
    }

    document.getElementById("items").value = items.join(", ");
    document.getElementById("binsize").value = bin_size;
  }

  // Random integer between min and max, inclusive
  function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

    // // Scroll to the output if it exists
    // window.onload = function () {
    //     const outputSection = document.querySelector(".output-section");
    //     if (outputSection) {
    //     outputSection.scrollIntoView({ behavior: "smooth" });
    //     }
    // };

    const results = document.getElementById("results");
    if (results) {
    results.scrollIntoView({ behavior: "smooth" });
    }
  </script>
</body>
</html>
