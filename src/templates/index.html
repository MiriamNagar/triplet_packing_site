<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Packing Algorithm Demo</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
</head>
<!-- Loading Spinner Overlay -->
<div id="loading-overlay">
  <div class="loading-content">
    <div class="spinner"></div>
    <p class="loading-text">Calculating...</p>
  </div>
</div>

<body>

  <div class="container">
    <!-- Title -->
    <header>
      <h1>Packing Algorithm Demo</h1>
      <p>Based on the article: <em>Your Algorithm Name Here</em></p>
    </header>

    <!-- Expandables -->
    <section class="expandables">
      <details>
        <summary>üß† About the Algorithm</summary>
        <p>Explain your algorithm here. You can include citation, behavior, etc.</p>
      </details>

      <details>
        <summary>üìò How to Use</summary>
        <p>Instructions on how users can input data, what to expect as output, etc.</p>
      </details>

      <details>
        <summary>üë©‚Äçüíª About the Developer</summary>
        <p>Write about yourself, your background, links to your GitHub, etc.</p>
      </details>
    </section>

    <!-- Input Section -->
    <section class="form-section">
      <form method="POST">

        <label>Number of Items:</label>
        <input type="number" name="num_items" id="num_items" placeholder="Optional ‚Äì multiple of 3" value="{{ request.form.get('num_items', '') }}" />
        
        <label>Items (comma-separated):</label>
        <textarea name="items" id="items" rows="3" placeholder="e.g., 300, 150, 200, 400">{{ request.form.get('items', '') }}</textarea>

        <label>Bin Size:</label>
        <input type="number" name="binsize" id="binsize" placeholder="e.g., 1000" value="{{ request.form.get('binsize', '') }}" />

        <label>method:</label>
        <select name="method" id="method">
          <option value="backtracking">backtracking</option>
          <option value="local search">local search</option>
        </select>

        <label for="log_level">Log Level:</label>
          <select id="log_level" name="log_level">
            <option value="DEBUG" {% if selected_log_level == "DEBUG" %}selected{% endif %}>DEBUG</option>
            <option value="INFO" {% if selected_log_level == "INFO" %}selected{% endif %}>INFO</option>
            <option value="WARNING" {% if selected_log_level == "WARNING" %}selected{% endif %}>WARNING</option>
            <option value="ERROR" {% if selected_log_level == "ERROR" %}selected{% endif %}>ERROR</option>
            <option value="CRITICAL" {% if selected_log_level == "CRITICAL" %}selected{% endif %}>CRITICAL</option>
          </select>

        {% if error_message %}
          <div class="error" id="error-message">
            <strong>‚ö†Ô∏è Error:</strong>
            <pre>{{ error_message }}</pre>
          </div>
        {% endif %}

        <div class="button-row">
          <button type="submit">Run Algorithm</button>
          <button type="button" onclick="fillExample()">Use Random Example Input</button>
          <button type="button" onclick="clearFields()">Clear Input</button>
        </div>
      </form>
    </section>

    <!-- Output Section -->
    {% if output %}
    <section class="output-section" id="results">
    <h2>üì¶ Output:</h2>
    <pre>{{ output }}</pre>

    <h3>ü™µ Run Logs:</h3>
    <pre>{{ logs }}</pre>
    </section>
    {% endif %}
  </div>

  <!-- JavaScript -->
  <script>
    // Show spinner on form submit
    document.querySelector("form").addEventListener("submit", function () {
        document.getElementById("loading-overlay").style.display = "flex";
    });

    // Scroll to results after reload
    window.onload = function () {
        const error = document.getElementById("error-message");
        const results = document.getElementById("results");

        if (error) {
            error.scrollIntoView({ behavior: "smooth", block: "center" });
        } else if (results) {
            results.scrollIntoView({ behavior: "smooth" });
        }
    };

  function fillExample() {
    const binInput = document.getElementById("binsize");
    const numItemsInput = document.getElementById("num_items");
    const itemsInput = document.getElementById("items");

    const MIN_BIN_SIZE = 100;
    const MAX_BIN_SIZE = 1000;
    const MIN_ITEMS = 6;
    const MAX_ITEMS = 60;

    // Generate bin size randomly
    const bin_size = getRandomInt(MIN_BIN_SIZE, MAX_BIN_SIZE);
    binInput.value = bin_size;

    // Check if user entered num_items
    let userNumItems = numItemsInput.value.trim();
    let num_items;

    if (userNumItems) {
      num_items = parseInt(userNumItems);
      if (isNaN(num_items) || num_items < 3 || num_items % 3 !== 0) {
        alert("Number of items must be a positive multiple of 3.");
        return;
      }
    } else {
      const groupCount = getRandomInt(MIN_ITEMS / 3, MAX_ITEMS / 3);
      num_items = groupCount * 3;
      numItemsInput.value = num_items;
    }

    // Generate items based on bin size and num_items
    const lower_bnd = Math.round(bin_size / 4);
    const upper_bnd = Math.round(bin_size / 2);
    const items = [];

    for (let i = 0; i < num_items / 3; i++) {
      const item1 = getRandomInt(lower_bnd, upper_bnd);
      const item2 = getRandomInt(lower_bnd, upper_bnd);
      const item3 = bin_size - (item1 + item2);
      items.push(item1, item2, item3);
    }

    itemsInput.value = items.join(", ");
  }

  function clearFields() {
    document.getElementById("items").value = '';
    document.getElementById("binsize").value = '';
    document.getElementById("num_items").value = '';
  }

  // Scroll to results or error if present
  window.onload = function () {
    const error = document.getElementById("error-message");
    const results = document.getElementById("results");
    if (error) {
      error.scrollIntoView({ behavior: "smooth", block: "center" });
    } else if (results) {
      results.scrollIntoView({ behavior: "smooth" });
    }
  };
  // Random integer between min and max (inclusive)
  function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

    const results = document.getElementById("results");
    if (results) {
    results.scrollIntoView({ behavior: "smooth" });
    }
  </script>
</body>
</html>
